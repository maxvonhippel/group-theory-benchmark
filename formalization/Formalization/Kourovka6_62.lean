/-
Kourovka Notebook Problem 6.62 (V. P. Shunkov)

Is a (conjugacy, p-conjugacy) biprimitively finite group finite if it has a finite
maximal subgroup (p-subgroup)?

DEFINITIONS:
- A group G is **conjugacy biprimitively finite** (also called a "Shunkov group")
  if for every two elements a, b of prime order in G such that b is conjugate to a⁻¹,
  the subgroup ⟨a, b⟩ generated by a and b is finite.
- A group G is **p-conjugacy biprimitively finite** if for every two elements a, b
  of order p such that b is conjugate to a⁻¹, the subgroup ⟨a, b⟩ is finite.

The problem asks two related questions:
1. If G is conjugacy biprimitively finite and has a finite maximal subgroup, is G finite?
2. If G is p-conjugacy biprimitively finite and has a finite maximal p-subgroup, is G finite?

KNOWN RESULTS (mentioned in the problem):
- Affirmative for conjugacy biprimitively finite p-groups
- Affirmative for 2-conjugacy biprimitively finite groups
- The statement does NOT hold for arbitrary periodic groups (Archive 3.9)
-/

import Mathlib.Algebra.Group.Subgroup.Basic
import Mathlib.GroupTheory.OrderOfElement
import Mathlib.GroupTheory.PGroup
import Mathlib.Order.Atoms
import Mathlib.Data.Nat.Prime.Defs

open Subgroup

variable {G : Type*} [Group G]

/-- Two elements a and b are conjugate in G if there exists g such that g * a * g⁻¹ = b -/
def AreConjugate (a b : G) : Prop :=
  ∃ g : G, g * a * g⁻¹ = b

/--
A group G is **conjugacy biprimitively finite** (a "Shunkov group") if:
for every pair of elements a, b of prime order in G such that b is conjugate to a⁻¹,
the subgroup generated by {a, b} is finite.
-/
def IsConjugacyBiprimFinite (G : Type*) [Group G] : Prop :=
  ∀ (a b : G),
    (orderOf a).Prime →
    (orderOf b).Prime →
    AreConjugate a⁻¹ b →
    Finite (closure ({a, b} : Set G))

/--
A group G is **p-conjugacy biprimitively finite** if:
for every pair of elements a, b of order p such that b is conjugate to a⁻¹,
the subgroup generated by {a, b} is finite.
-/
def IsPConjugacyBiprimFinite (G : Type*) [Group G] (p : ℕ) : Prop :=
  ∀ (a b : G),
    orderOf a = p →
    orderOf b = p →
    AreConjugate a⁻¹ b →
    Finite (closure ({a, b} : Set G))

/--
A subgroup H is maximal if it is a coatom in the subgroup lattice,
i.e., H ≠ ⊤ and for any K with H < K, we have K = ⊤.
-/
def IsMaximalSubgroup (H : Subgroup G) : Prop := IsCoatom H

/--
A subgroup P is a p-subgroup if it is a p-group.
-/
def IsPSubgroup (H : Subgroup G) (p : ℕ) [Fact (Nat.Prime p)] : Prop :=
  IsPGroup p H

/--
A subgroup P is a **maximal p-subgroup** if it is a p-subgroup and is maximal
among all p-subgroups (i.e., no p-subgroup properly contains it).
-/
def IsMaximalPSubgroup (H : Subgroup G) (p : ℕ) [Fact (Nat.Prime p)] : Prop :=
  IsPSubgroup H p ∧ ∀ K : Subgroup G, IsPSubgroup K p → H ≤ K → K = H

/--
**Kourovka Problem 6.62a** (Conjugacy version):

Is a conjugacy biprimitively finite group finite if it has a finite maximal subgroup?
-/
theorem kourovka_6_62a
    (G : Type*) [Group G]
    (hG : IsConjugacyBiprimFinite G)
    (M : Subgroup G)
    (hM_max : IsMaximalSubgroup M)
    [hM_fin : Finite M] :
    Finite G := by
  sorry

/--
**Kourovka Problem 6.62b** (p-Conjugacy version):

Is a p-conjugacy biprimitively finite group finite if it has a finite maximal p-subgroup?
-/
theorem kourovka_6_62b
    (G : Type*) [Group G]
    (p : ℕ) [hp : Fact (Nat.Prime p)]
    (hG : IsPConjugacyBiprimFinite G p)
    (P : Subgroup G)
    (hP_max : IsMaximalPSubgroup P p)
    [hP_fin : Finite P] :
    Finite G := by
  sorry

/-!
## Known Results

The problem states that there are affirmative answers in special cases.
-/

/--
Known result: Conjugacy biprimitively finite p-groups with finite maximal subgroups are finite.
(V. P. Shunkov, Algebra and Logic, 9, no. 4 (1970), 291–297)
-/
theorem kourovka_6_62_known_pgroup
    (G : Type*) [Group G]
    (p : ℕ) [hp : Fact (Nat.Prime p)]
    (hpG : IsPGroup p G)
    (hG : IsConjugacyBiprimFinite G)
    (M : Subgroup G)
    (hM_max : IsMaximalSubgroup M)
    [hM_fin : Finite M] :
    Finite G := by
  sorry

/--
Known result: 2-conjugacy biprimitively finite groups with finite maximal 2-subgroups are finite.
(V. P. Shunkov, Algebra and Logic, 11, no. 4 (1972), 260–272; 12, no. 5 (1973), 347–353)
-/
theorem kourovka_6_62_known_2conj
    (G : Type*) [Group G]
    (hG : IsPConjugacyBiprimFinite G 2)
    (P : Subgroup G)
    (hP_max : @IsMaximalPSubgroup G _ P 2 ⟨Nat.prime_two⟩)
    [hP_fin : Finite P] :
    Finite G := by
  sorry
