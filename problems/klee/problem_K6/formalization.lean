import Mathlib

open Set Topology

/-!
# Generation of Convex Borel Sets (Problem K6)

This formalizes the core mathematical concepts and concrete questions from Problem K6.

## Problem Statement (summary)

For a family S of subsets of Eⁿ:
- S₁ = unions of increasing sequences from S
- S₂ = intersections of decreasing sequences from S₁
- S_{2n+1} = unions of increasing sequences from S_{2n}
- S_{2n+2} = intersections of decreasing sequences from S_{2n+1}

Let F = closed sets, K = closed convex sets.

Questions:
1. Must each convex member of F₂ be in K₄?
2. Determine t(m,i) = smallest t such that m-dim convex members of Fᵢ are in Kₜ
3. If t fails to exist, is every m-dim convex member of Fᵢ in some Kⱼ?
4. Is every convex member of BF a member of BK?

Questions 2-3 are open-ended/investigative. We formalize 1 and 4 as conjectures.
-/

section Hierarchy

variable (E : Type*) [TopologicalSpace E]

/-- A sequence is increasing (for set inclusion) -/
def IsIncreasingSeq (f : ℕ → Set E) : Prop :=
  ∀ i j, i ≤ j → f i ⊆ f j

/-- A sequence is decreasing (for set inclusion) -/
def IsDecreasingSeq (f : ℕ → Set E) : Prop :=
  ∀ i j, i ≤ j → f j ⊆ f i

/-- S_{odd}: unions of increasing sequences from S -/
def HierarchyUnions (S : Set (Set E)) : Set (Set E) :=
  { s | ∃ f : ℕ → Set E, (∀ i, f i ∈ S) ∧ IsIncreasingSeq E f ∧ s = ⋃ i, f i }

/-- S_{even}: intersections of decreasing sequences from S -/
def HierarchyInters (S : Set (Set E)) : Set (Set E) :=
  { s | ∃ f : ℕ → Set E, (∀ i, f i ∈ S) ∧ IsDecreasingSeq E f ∧ s = ⋂ i, f i }

/-- The hierarchy S_i starting from S_0 = S.
    Following the problem statement:
    - S_1 = unions of increasing sequences from S
    - S_2 = intersections of decreasing sequences from S_1
    - S_{2n+1} = unions of increasing sequences from S_{2n}
    - S_{2n+2} = intersections of decreasing sequences from S_{2n+1} -/
noncomputable def SetHierarchy (S : Set (Set E)) : ℕ → Set (Set E)
  | 0 => S
  | k + 1 => if k % 2 = 0 then HierarchyUnions E (SetHierarchy S k)
             else HierarchyInters E (SetHierarchy S k)

/-- F = family of all closed subsets of E -/
def ClosedSets : Set (Set E) :=
  { s | IsClosed s }

end Hierarchy

section ConvexSets

variable (E : Type*) [TopologicalSpace E] [AddCommMonoid E] [Module ℝ E]

/-- K = family of all closed convex subsets of E -/
def ClosedConvexSets : Set (Set E) :=
  { s | IsClosed s ∧ Convex ℝ s }

/-- F_i = the i-th level of the hierarchy starting from closed sets -/
noncomputable def F_hierarchy : ℕ → Set (Set E) :=
  SetHierarchy E (ClosedSets E)

/-- K_i = the i-th level of the hierarchy starting from closed convex sets -/
noncomputable def K_hierarchy : ℕ → Set (Set E) :=
  SetHierarchy E (ClosedConvexSets E)

end ConvexSets

section BorelFamily

variable (E : Type*) [TopologicalSpace E]

/-- The family BS is the smallest family containing S that is closed under
    countable increasing unions and countable decreasing intersections -/
inductive BorelFamily (S : Set (Set E)) : Set E → Prop
  | base : ∀ s ∈ S, BorelFamily S s
  | iUnion_inc : ∀ f : ℕ → Set E, (∀ i, BorelFamily S (f i)) →
      IsIncreasingSeq E f → BorelFamily S (⋃ i, f i)
  | iInter_dec : ∀ f : ℕ → Set E, (∀ i, BorelFamily S (f i)) →
      IsDecreasingSeq E f → BorelFamily S (⋂ i, f i)

/-- BF = the Borel family generated by closed sets -/
def BF : Set (Set E) := { s | BorelFamily E (ClosedSets E) s }

end BorelFamily

section BorelConvex

variable (E : Type*) [TopologicalSpace E] [AddCommMonoid E] [Module ℝ E]

/-- BK = the Borel family generated by closed convex sets -/
def BK : Set (Set E) := { s | BorelFamily E (ClosedConvexSets E) s }

end BorelConvex

/-!
## Main Conjectures from Problem K6

The problem asks several questions. We formalize the ones that are concrete yes/no questions.
-/

section MainConjectures

-- We work with Euclidean space ℝ^n
abbrev EuclideanN (n : ℕ) := EuclideanSpace ℝ (Fin n)

/-- Conjecture 1: Every convex member of F₂ is a member of K₄.
    "Must each convex member of F₂ be a member of K₄?" -/
def Conjecture_F2_subset_K4 (n : ℕ) : Prop :=
  ∀ s : Set (EuclideanN n),
    s ∈ F_hierarchy (EuclideanN n) 2 →
    Convex ℝ s →
    s ∈ K_hierarchy (EuclideanN n) 4

/-- Conjecture 4: Every convex member of BF is a member of BK.
    "Is every convex member of BF a member of BK?" -/
def Conjecture_ConvexBF_subset_BK (n : ℕ) : Prop :=
  ∀ s : Set (EuclideanN n),
    s ∈ BF (EuclideanN n) →
    Convex ℝ s →
    s ∈ BK (EuclideanN n)

/-!
## Note on Questions 2 and 3

Question 2 asks to "determine" the smallest t = t(m,i) such that every
m-dimensional convex member of F_i is in K_t. This is an open-ended
investigative question asking for a function, not a yes/no statement.

Question 3 is conditional on Question 2 failing for some parameters.

We can express the existence claim from Question 3 though:
-/

/-- Weak existence claim from Question 3: For any convex set in F_i,
    there exists some j such that it belongs to K_j.

    Note: The original problem refers to "m-dimensional" sets, which requires
    formalizing affine dimension. We use the ambient dimension instead. -/
def WeakClaim_Exists_j (n i : ℕ) : Prop :=
  ∀ s : Set (EuclideanN n),
    s ∈ F_hierarchy (EuclideanN n) i →
    Convex ℝ s →
    ∃ j : ℕ, s ∈ K_hierarchy (EuclideanN n) j

end MainConjectures
