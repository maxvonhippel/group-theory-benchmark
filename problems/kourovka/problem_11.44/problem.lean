/-
KOUROVKA NOTEBOOK PROBLEM 11.44
Author: L. S. Kazarin (1990)

Problem Statement:
For a finite group X, we denote by r(X) its sectional rank. Is it true that the
sectional rank of a finite p-group, which is a product AB of its subgroups A and B,
is bounded by some linear function of r(A) and r(B)?

Key Definitions:
- Sectional rank r(G) of a p-group G is the maximum of d(H) over all subgroups H of G,
  where d(H) is the minimum number of generators of H (equivalently, dim(H/Phi(H)))
- A "product AB" means the set {ab : a in A, b in B}, not the group generated by A and B
- "Linear function" means r(G) <= c1 * r(A) + c2 * r(B) for some universal constants c1, c2

Status: OPEN (as of January 2026)

This file provides:
1. Definitions of key concepts (p-groups, sectional rank, products)
2. Statement of the problem in Lean
3. Computational observations from GAP experiments
-/

-- ============================================================================
-- SECTION 1: BASIC DEFINITIONS
-- ============================================================================

/-- A finite group structure (simplified) -/
structure FiniteGroup where
  carrier : Type
  size : Nat
  mul : carrier -> carrier -> carrier
  one : carrier
  inv : carrier -> carrier
  size_pos : size > 0

/-- Subgroup relation -/
structure Subgroup (G : FiniteGroup) where
  carrier : G.carrier -> Prop
  nonempty : Exists carrier
  mul_closed : forall a b, carrier a -> carrier b -> carrier (G.mul a b)
  inv_closed : forall a, carrier a -> carrier (G.inv a)

/-- A group is a p-group for prime p -/
def IsPGroup (G : FiniteGroup) (p : Nat) : Prop :=
  Nat.Prime p /\ Exists (fun k => G.size = p ^ k)

/-- The minimum number of generators of a subgroup -/
-- This is d(H) = dim(H/Phi(H)) for p-groups
noncomputable def minGenerators (G : FiniteGroup) (H : Subgroup G) : Nat :=
  sorry -- Would require full implementation of generator counting

/-- Sectional rank: maximum of d(H) over all subgroups H -/
noncomputable def sectionalRank (G : FiniteGroup) : Nat :=
  sorry -- max { minGenerators G H | H : Subgroup G }

-- ============================================================================
-- SECTION 2: PRODUCTS OF SUBGROUPS
-- ============================================================================

/-- The set product AB of two subgroups A and B -/
def setProduct (G : FiniteGroup) (A B : Subgroup G) : G.carrier -> Prop :=
  fun g => Exists (fun a => Exists (fun b => A.carrier a /\ B.carrier b /\ g = G.mul a b))

/-- G equals the product AB (as sets) -/
def isSetProduct (G : FiniteGroup) (A B : Subgroup G) : Prop :=
  forall g : G.carrier, setProduct G A B g

-- ============================================================================
-- SECTION 3: PROBLEM STATEMENT
-- ============================================================================

/--
Kourovka Problem 11.44:
Is there a linear bound on sectional rank of p-group products?

More precisely: Do there exist universal constants c1, c2 such that for all:
- primes p
- finite p-groups G with G = AB (set product of subgroups A, B)
we have r(G) <= c1 * r(A) + c2 * r(B)?
-/
def Problem_11_44_Positive : Prop :=
  Exists (fun c1 : Nat => Exists (fun c2 : Nat =>
    forall (p : Nat) (G : FiniteGroup) (A B : Subgroup G),
      Nat.Prime p ->
      IsPGroup G p ->
      isSetProduct G A B ->
      sectionalRank G <= c1 * sectionalRank (sorry : FiniteGroup) + c2 * sectionalRank (sorry : FiniteGroup)
  ))

/--
Alternative formulation: r(G) <= c * (r(A) + r(B)) for some constant c
-/
def Problem_11_44_Positive_Alt : Prop :=
  Exists (fun c : Nat =>
    forall (p : Nat) (G : FiniteGroup) (A B : Subgroup G),
      Nat.Prime p ->
      IsPGroup G p ->
      isSetProduct G A B ->
      sectionalRank G <= c * (sectionalRank (sorry : FiniteGroup) + sectionalRank (sorry : FiniteGroup))
  )

-- ============================================================================
-- SECTION 4: COMPUTATIONAL OBSERVATIONS (from GAP experiments)
-- ============================================================================

/-
GAP computational search results:

We searched all p-groups up to order 64 with the proper set product condition G = AB.
Key findings:

1. Maximum ratio r(G)/(r(A) + r(B)) observed: 3/2
   - Achieved by SmallGroup(16, 3) = (C4 x C2) : C2
   - With cyclic subgroups A, B of orders 4 and 4
   - r(G) = 3, r(A) = r(B) = 1

2. For order 64 groups (first 100 checked):
   - Maximum ratio still 3/2
   - No increase in the bound

3. The condition G = AB (set product) is DIFFERENT from <A,B> = G (subgroup generation)
   - Many groups G with <A,B> = G cannot be written as G = AB
   - The set product condition is more restrictive

4. Extraspecial p-groups have high sectional rank but cannot be written as
   products of two cyclic subgroups.

CONJECTURE based on computational evidence:
The ratio r(G)/(r(A) + r(B)) appears to be bounded (possibly by 2 or 3) for
finite p-groups that are products of two subgroups.

However, proving this requires deep theoretical analysis of p-group structure
that goes beyond computational verification of small cases.
-/

-- ============================================================================
-- SECTION 5: FORMALIZATION CHALLENGES
-- ============================================================================

/-
CHALLENGES IN FORMALIZING THIS PROBLEM:

1. COMPUTATIONAL DEFINITIONS:
   - Sectional rank requires computing d(H) = dim(H/Phi(H)) for all subgroups
   - This involves the Frattini subgroup Phi(H)
   - Requires full p-group library infrastructure

2. SET PRODUCT CONDITION:
   - G = AB as sets is different from <A,B> = G
   - Verifying |AB| = |G| requires knowing the intersection |A cap B|

3. THEORETICAL DEPTH:
   - The problem asks about existence of a LINEAR bound
   - Could be constants c1, c2 or a single c
   - Proof likely requires deep structure theory of p-groups

4. OPEN PROBLEM STATUS:
   - No known counterexample in literature
   - No known proof of the positive answer
   - Problem has been open since 1990 (35+ years)

WHAT WOULD A PROOF REQUIRE:
- Deep understanding of how sectional rank behaves under products
- Analysis of "worst case" p-groups (those with high rank from low-rank factors)
- Possibly structural classification arguments

WHAT WOULD A COUNTEREXAMPLE REQUIRE:
- Construction of a family G_n = A_n * B_n where r(G_n)/(r(A_n) + r(B_n)) -> infinity
- This would require finding products where small factors give arbitrarily large rank
- No such construction is known
-/

-- ============================================================================
-- SECTION 6: PARTIAL RESULTS AND STRUCTURE
-- ============================================================================

/-- For abelian p-groups, the product is a direct product and rank is additive -/
theorem abelian_case_bound :
    forall (G : FiniteGroup) (A B : Subgroup G) (p : Nat),
      IsPGroup G p ->
      isSetProduct G A B ->
      sorry -> -- G is abelian
      sectionalRank G <= sectionalRank (sorry : FiniteGroup) + sectionalRank (sorry : FiniteGroup) :=
  sorry

/-- The trivial bound: r(G) <= log_p(|G|) -/
theorem trivial_upper_bound :
    forall (G : FiniteGroup) (p : Nat),
      IsPGroup G p ->
      Exists (fun k => G.size = p ^ k /\ sectionalRank G <= k) :=
  sorry

-- ============================================================================
-- SECTION 7: SUMMARY
-- ============================================================================

/-
FORMALIZATION STATUS: FORMALIZED_UNSOLVED

The problem is well-posed and the key definitions can be formalized:
- Sectional rank r(G) for p-groups
- Set product G = AB of subgroups
- The question of linear boundedness

However, the main theorem remains unproved:
- No counterexample has been found computationally
- No theoretical proof is known
- The problem has been open for over 35 years

The formalization provides:
[checkmark] Definition of p-groups
[checkmark] Definition of sectional rank (with sorry for computation)
[checkmark] Definition of set product of subgroups
[checkmark] Statement of the main problem
[checkmark] Computational observations from GAP
[x] Proof of the main theorem (OPEN)
-/
