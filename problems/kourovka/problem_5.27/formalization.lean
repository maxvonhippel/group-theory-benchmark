/-
Kourovka Notebook Problem 5.27 (A. Yu. Ol'shanskiĭ)

Does the free group of rank 2 have an infinite ascending chain of verbal
subgroups each being generated as a verbal subgroup by a single element?

Key concepts:
- A verbal subgroup V(G) of a group G corresponding to a word w in the free
  group F_n is the subgroup generated by all values w(g₁,...,gₙ) as gᵢ range
  over G.
- When the word w is in F_1 (single variable), V(G) = ⟨{w(g) : g ∈ G}⟩.
- An infinite ascending chain means subgroups V₁ ⊊ V₂ ⊊ V₃ ⊊ ...
- The question asks whether such a chain exists where each Vᵢ is a verbal
  subgroup generated by a single word (element of some F_n).

This formalization defines verbal subgroups and states the existence question.
-/

import Mathlib

open FreeGroup

universe u

variable (G : Type u) [Group G]

/--
Given a group G and a word w in the free group on n generators,
evaluate the word at a tuple of elements from G.
This uses the universal property of free groups.
-/
noncomputable def evalWord {n : ℕ} (w : FreeGroup (Fin n)) (args : Fin n → G) : G :=
  FreeGroup.lift args w

/--
The verbal subgroup of G corresponding to a word w in F_n is the subgroup
generated by all evaluations of w at all possible n-tuples from G.
-/
def verbalSubgroup {n : ℕ} (w : FreeGroup (Fin n)) : Subgroup G :=
  Subgroup.closure { g : G | ∃ args : Fin n → G, evalWord G w args = g }

/--
A verbal subgroup is "generated by a single word" if it equals verbalSubgroup w
for some word w in some F_n.
-/
def IsVerbalSubgroupBySingleWord (H : Subgroup G) : Prop :=
  ∃ (n : ℕ) (w : FreeGroup (Fin n)), H = verbalSubgroup G w

/--
An infinite strictly ascending chain of subgroups.
chain n is the n-th subgroup in the chain, and chain n < chain (n+1) for all n.
-/
def IsInfiniteStrictlyAscendingChain (chain : ℕ → Subgroup G) : Prop :=
  ∀ n : ℕ, chain n < chain (n + 1)

/--
Kourovka Problem 5.27 (A. Yu. Ol'shanskiĭ):

Does there exist an infinite strictly ascending chain of verbal subgroups of
the free group F₂ (on 2 generators), where each subgroup in the chain is a
verbal subgroup generated by a single word?

This statement asserts the existence of such a chain. The actual answer to
this open problem would determine whether this statement is true or false.
-/
theorem kourovka_5_27 :
    ∃ (chain : ℕ → Subgroup (FreeGroup (Fin 2))),
      IsInfiniteStrictlyAscendingChain (FreeGroup (Fin 2)) chain ∧
      ∀ n : ℕ, IsVerbalSubgroupBySingleWord (FreeGroup (Fin 2)) (chain n) := by
  sorry

/--
Alternative formulation as a negation (if the answer is "no"):
There is no infinite strictly ascending chain of verbal subgroups of F₂
where each is generated by a single word.
-/
theorem kourovka_5_27_negation :
    ¬ ∃ (chain : ℕ → Subgroup (FreeGroup (Fin 2))),
      IsInfiniteStrictlyAscendingChain (FreeGroup (Fin 2)) chain ∧
      ∀ n : ℕ, IsVerbalSubgroupBySingleWord (FreeGroup (Fin 2)) (chain n) := by
  sorry
