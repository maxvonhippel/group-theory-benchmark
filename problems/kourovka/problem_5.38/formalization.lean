/-
Kourovka Notebook Problem 5.38 (P. M. Neumann)

Is it the case that if A, B are finitely generated soluble Hopfian groups
then A × B is Hopfian?

Key definitions:
- A group G is *Hopfian* if every surjective endomorphism is an isomorphism
  (equivalently, every surjective endomorphism is injective).
- A group is *soluble* (solvable) if its derived series eventually reaches the trivial group.
- A group is *finitely generated* if it is generated by a finite set.
-/

import Mathlib.GroupTheory.Solvable
import Mathlib.GroupTheory.Finiteness

/-!
## Hopfian Groups

A group G is Hopfian if every surjective endomorphism is an isomorphism.
Equivalently, G is not isomorphic to any proper quotient of itself.
-/

/--
A group G is *Hopfian* if every surjective group homomorphism from G to itself
is necessarily injective (hence an isomorphism).
-/
def IsHopfian (G : Type*) [Group G] : Prop :=
  ∀ f : G →* G, Function.Surjective f → Function.Injective f

/-!
## Main Problem Statement
-/

/--
**Kourovka Problem 5.38** (P. M. Neumann):

If A and B are finitely generated solvable Hopfian groups, is A × B Hopfian?

This theorem states the implication as a conjecture (with sorry).
-/
theorem kourovka_5_38
    (A B : Type*) [Group A] [Group B]
    [hA_fg : Group.FG A] [hB_fg : Group.FG B]
    [hA_solv : IsSolvable A] [hB_solv : IsSolvable B]
    (hA_hopf : IsHopfian A) (hB_hopf : IsHopfian B) :
    IsHopfian (A × B) := by
  sorry

/--
Alternative formulation as an open question:
Does there exist a counterexample, i.e., finitely generated solvable Hopfian groups
A and B such that A × B is not Hopfian?
-/
def kourovka_5_38_counterexample : Prop :=
  ∃ (A B : Type) (_ : Group A) (_ : Group B),
    Group.FG A ∧ Group.FG B ∧
    IsSolvable A ∧ IsSolvable B ∧
    IsHopfian A ∧ IsHopfian B ∧
    ¬ IsHopfian (A × B)

/--
The problem is equivalent to asking: is there no counterexample?
-/
theorem kourovka_5_38_equiv :
    (∀ (A B : Type) [Group A] [Group B] [Group.FG A] [Group.FG B]
       [IsSolvable A] [IsSolvable B],
       IsHopfian A → IsHopfian B → IsHopfian (A × B)) ↔
    ¬ kourovka_5_38_counterexample := by
  sorry
