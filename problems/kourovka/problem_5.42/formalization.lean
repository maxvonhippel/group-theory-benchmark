/-
Kourovka Notebook Problem 5.42 (attributed to A. Yu. Ol'shanskiĭ):

Does the free group of rank 2 have an infinite ascending chain of verbal subgroups
each being generated as a verbal subgroup by a single element?
-/

import Mathlib.GroupTheory.FreeGroup.Basic
import Mathlib.Algebra.Group.Subgroup.Basic
import Mathlib.Data.Fin.Basic

/-- The free group on 2 generators, represented as FreeGroup (Fin 2) -/
abbrev F₂ := FreeGroup (Fin 2)

/-- Given a word w in the free group on n generators and a function f : Fin n → G
    (representing the substitution of generators by elements of G),
    we evaluate the word in G using FreeGroup.lift. -/
def evalWord {n : ℕ} (w : FreeGroup (Fin n)) {G : Type*} [Group G] (f : Fin n → G) : G :=
  FreeGroup.lift f w

/-- The set of all values obtained by evaluating a word w in a group G under all
    possible substitutions. -/
def wordValues {n : ℕ} (w : FreeGroup (Fin n)) (G : Type*) [Group G] : Set G :=
  { g : G | ∃ f : Fin n → G, evalWord w f = g }

/-- The verbal subgroup of G determined by a word w is the subgroup generated
    by all values of w under substitutions from G. -/
def verbalSubgroup {n : ℕ} (w : FreeGroup (Fin n)) (G : Type*) [Group G] : Subgroup G :=
  Subgroup.closure (wordValues w G)

/-- For F₂ specifically: a verbal subgroup generated by a single word (element)
    of the free group on some number of generators. We use 2 generators for the word
    since we're studying F₂ and words in 2 variables suffice. -/
def verbalSubgroupF₂ (w : FreeGroup (Fin 2)) : Subgroup F₂ :=
  verbalSubgroup w F₂

/-- An ascending chain of verbal subgroups of F₂, each generated by a single word.
    The chain is indexed by natural numbers, and we require strict inclusion. -/
structure AscendingVerbalChain where
  /-- For each n, a word that generates the n-th verbal subgroup -/
  word : ℕ → FreeGroup (Fin 2)
  /-- The chain is strictly ascending: V_{word n} ⊊ V_{word (n+1)} for all n -/
  strictly_ascending : ∀ n : ℕ,
    verbalSubgroupF₂ (word n) < verbalSubgroupF₂ (word (n + 1))

/-- Kourovka Problem 5.42: Does F₂ have an infinite ascending chain of verbal subgroups,
    each generated (as a verbal subgroup) by a single element?

    This is formalized as: Does there exist an AscendingVerbalChain? -/
def kourovka_5_42 : Prop :=
  Nonempty AscendingVerbalChain

/-- The problem asks whether this proposition is true or false.
    By excluded middle, one of these holds - the open problem is determining which. -/
theorem kourovka_5_42_answer : kourovka_5_42 ∨ ¬kourovka_5_42 :=
  Classical.em _
