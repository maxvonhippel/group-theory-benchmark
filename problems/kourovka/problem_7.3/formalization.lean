/-
Kourovka Notebook Problem 7.3 (S. I. Adian)

Prove that the periodic product of odd exponent n ≥ 665 of non-trivial groups F₁, ..., Fₖ
which do not contain involutions cannot be generated by less than k elements.

This would imply, on the basis of (S. I. Adian, Sov. Math. Doklady, 19, (1978), 910–913),
the existence of k-generated simple groups which cannot be generated by less than k elements,
for any k > 0.

The "periodic product" is a highly technical construction from Adian-Novikov's work on the
Burnside problem. It is defined as a specific quotient of the free product F₁ * ... * Fₖ
by the normal closure of n-th powers, but with additional conditions on "periodic words"
that are not easily expressible without substantial development.
-/

import Mathlib.GroupTheory.CoprodI
import Mathlib.GroupTheory.Exponent
import Mathlib.GroupTheory.Rank
import Mathlib.GroupTheory.OrderOfElement
import Mathlib.GroupTheory.QuotientGroup.Basic
import Mathlib.Data.Fintype.Card

/-!
## Basic Definitions
-/

/--
A group element is an involution if it has order exactly 2.
-/
def IsInvolution {G : Type*} [Group G] (g : G) : Prop := orderOf g = 2

/--
A group has no involutions if no element has order 2.
-/
def NoInvolutions (G : Type*) [Group G] : Prop := ∀ g : G, ¬IsInvolution g

/--
A group is simple if it is non-trivial and has no proper non-trivial normal subgroups.
-/
def IsSimpleGroup (G : Type*) [Group G] : Prop :=
  Nontrivial G ∧ ∀ N : Subgroup G, N.Normal → N = ⊥ ∨ N = ⊤

/-!
## The Periodic Product

The periodic product Π(F₁, ..., Fₖ; n) is defined as follows:
1. Start with the free product (coproduct) F₁ * F₂ * ... * Fₖ
2. Quotient by the normal closure of all n-th powers

This gives a group of exponent dividing n. The construction is due to Adian-Novikov
and is fundamental to their solution of the Burnside problem for large odd exponents.

We define it concretely using Mathlib's CoprodI (indexed coproduct of groups).
-/

open Monoid

variable {ι : Type*} [DecidableEq ι] {G : ι → Type*} [∀ i, Group (G i)]

/--
The normal subgroup generated by all n-th powers in a group.
For the free product, this is the kernel of the map to the Burnside quotient.
-/
def nthPowerNormalClosure (H : Type*) [Group H] (n : ℕ) : Subgroup H :=
  Subgroup.normalClosure { g ^ n | g : H }

instance nthPowerNormalClosure_normal (H : Type*) [Group H] (n : ℕ) :
    (nthPowerNormalClosure H n).Normal :=
  Subgroup.normalClosure_normal

/--
The periodic product (Burnside quotient) of an indexed family of groups with exponent n.
This is the coproduct (free product) quotiented by the normal closure of all n-th powers.
-/
def PeriodicProduct (G : ι → Type*) [∀ i, Group (G i)] (n : ℕ) : Type _ :=
  CoprodI G ⧸ nthPowerNormalClosure (CoprodI G) n

instance periodicProductGroup (G : ι → Type*) [∀ i, Group (G i)] (n : ℕ) :
    Group (PeriodicProduct G n) :=
  QuotientGroup.Quotient.group _

/--
The canonical map from each factor into the periodic product.
-/
def PeriodicProduct.of (G : ι → Type*) [∀ i, Group (G i)] (n : ℕ) (i : ι) :
    G i →* PeriodicProduct G n :=
  (QuotientGroup.mk' (nthPowerNormalClosure (CoprodI G) n)).comp (CoprodI.of (M := G))

/-!
## Main Theorem Statement

For the periodic product to have the properties claimed in Problem 7.3,
the exponent n must be odd and at least 665 (the Adian-Novikov bound).
Under these conditions:
- The embeddings of factors are injective
- The absence of involutions is preserved
- The rank is at least the number of factors
-/

/--
**Kourovka Problem 7.3** (S. I. Adian):

For odd n ≥ 665 and non-trivial groups F₁, ..., Fₖ without involutions,
the periodic product of exponent n cannot be generated by fewer than k elements.

More precisely: Group.rank (PeriodicProduct F n) ≥ k.
-/
theorem kourovka_7_3
    {k : ℕ} (hk : k ≥ 1)
    {F : Fin k → Type*} [∀ i, Group (F i)] [DecidableEq (Fin k)]
    (hNontrivial : ∀ i, Nontrivial (F i))
    (hNoInvolutions : ∀ i, NoInvolutions (F i))
    {n : ℕ} (hn_odd : Odd n) (hn_large : n ≥ 665)
    [Group.FG (PeriodicProduct F n)] :
    Group.rank (PeriodicProduct F n) ≥ k := by
  sorry

/-!
## Remarks

### On the Periodic Product Construction

The periodic product as defined here (quotient of free product by n-th powers) is the
"universal" construction. Adian-Novikov's work shows that for odd n ≥ 665:

1. **Infiniteness**: The free Burnside group B(m, n) = Fm / ⟨gⁿ⟩ is infinite for m ≥ 2.

2. **Injectivity**: The canonical maps Fᵢ → Π(F₁,...,Fₖ; n) are injective when
   each Fᵢ is non-trivial and has no involutions.

3. **Preservation of properties**: The absence of involutions in the factors
   implies absence of involutions in the periodic product.

### The bound n ≥ 665

The bound 665 comes from Adian's original work. Subsequent improvements have lowered
this bound, but 665 remains historically significant as the first explicit bound
for which the Burnside problem has a negative answer.

### Consequences

If this theorem holds, Adian showed (1978) that there exist k-generated simple groups
that cannot be generated by fewer than k elements, for any k > 0. This resolved a
long-standing question about the minimum number of generators for simple groups.
-/

/--
Corollary: For any k ≥ 1, there exists a k-generated simple group
that cannot be generated by fewer than k elements.

This follows from Problem 7.3 combined with Adian's construction (1978).
-/
theorem simple_groups_with_exact_rank (k : ℕ) (hk : k ≥ 1) :
    ∃ (S : Type) (_ : Group S) (_ : Group.FG S),
      IsSimpleGroup S ∧ Group.rank S = k := by
  sorry
